# 创建线程

## 创建变量储存线程 id

```c
pthread_t pth ;//线程id
```

## (可选)可自定义线程属性,也可使用默认 NULL

```c
//自定义线程属性

pthread_attr_t attr;// 初始化线程属性 && creat 也可传 NULL

//初始化线程属性
int pthread_attr_init(pthread_attr_t *attr);
    //销毁线程属性所占用的资源
    pthread_attr_destroy();

//设置线程属性，分离 or 非分离
int pthread_attr_setdetachstate(pthread_attr_t *attr, int detachstate);

//获取程属性，分离 or 非分离
int pthread_attr_getdetachstate(pthread_attr_t *attr, int *detachstate);
    // detachstate：
    //     PTHREAD_CREATE_DETACHED（分离线程）
    //     PTHREAD _CREATE_JOINABLE（非分离线程）

int pthread_attr_getdetachstate(const pthread_attr_t *__attr, int *__detachstate);
//获取线程状态保存到第二个参数
    // 判断线程状态

if (detachstate == PTHREAD_CREATE_DETACHED) //判断分离
    printf("thread detached\n");
else if (detachstate == PTHREAD_CREATE_JOINABLE)//判断非分离
    printf("thread join\n");
else
    printf("thread unknown\n");
```

## creat 线程

pthread_create(&pth, NULL, (void _)func, (void _)argv);
(指定线程 id,线程属性,执行函数,函数参数)

```c
int pthread_create(pthread_t *__restrict__ __newthread, const pthread_attr_t *__restrict__ __attr, void *(*__start_routine)(void *), void *__restrict__ __arg)
```

## 线程其他用法

```c
pthread_exit()//退出线程
pthread_join()//阻塞等待回收线程 ,第二个参数保存返回值
pthread_cancel() //取消线程(到达取消点时取消)
pthread_self();//获取线程id

```

# 互斥量使用

## 初始化互斥量

### 1. 静态初始化：如果互斥锁 mutex 是静态分配的（定义在全局，或加了 static 关键字修饰），可以直接 使用宏进行初始化。(可移植性差)

```c
pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;
```

### 2. 动态初始化：局部变量应采用动态初始化。

```c
    pthread_mutex_init(&lock, NULL)//默认属性(线程间共享)
```

## 正常 [创建线程](#创建线程)

## 每个线程中

```c
pthread_mutex_lock(&lock);或 pthread_mutex_trylock(&lock);
/*------------  使用 -------------*/
pthread_mutex_unlock(&lock);
```

## 销毁互斥量(仅动态初始化)

```c
pthread_mutex_destroy(&lock);
```

# 条件变量 pthread_cond_t

> `经常结合互斥量使用,且与互斥量使用方式类似`

## 条件变量初始化

### 静态初始化
```c
pthread_cond_t cond=THREAD_COND_INITIALIZE;
```
### 动态初始化
```c
pthread_cond_init();
```

## 通知与等待
```c

pthread_cond_signal();//只保证唤醒至少一条遭到阻塞的线程
pthread_cond_broadcast();//会唤醒所有遭阻塞的线程



pthread_cond_wait();//函数将阻塞一线程，直至收到条件变量 cond的通知。
pthread_cond_timedwait();//参数来指定休眠时间的上限。
    /*
    参数abstime是一个timespec类型的结构（见23.4.2节），用以指定自Epoch（参考10.1节）以来以秒和纳秒（nanosecond）为单位表示的绝对（absolute）时间。如果abstime指定的时间间隔到期且无相关条件变量的通知，则返回ETIMEOUT错误
    */
```
## 条件变量判断





## 使用


### 生产者(子线程)
1.加锁

2.操作

3.通知

4.解锁

### 消费者(主线程)

1.加锁

2.[判断](#条件变量判断)
    
    不符合:wait
    
    符合:操作

3.解锁
